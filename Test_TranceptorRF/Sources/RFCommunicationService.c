/*
 * RFCommunicationService.c
 *
 *  Created on: Jan 14, 2019
 *      Author: José Padilla
 */
/*************************************************************************************************/
/*********************						Includes						**********************/
/*************************************************************************************************/
/* System includes */

/* Includes used in this file */

/* Own includes */
#include "RFCommunicationService.h"

/*************************************************************************************************/
/*********************						Defines							**********************/
/*************************************************************************************************/
#define RFCommBusSTXCmd								(0x02)
#define RFCommBusETXCmd								(0x03)

#define RFCommBufferSize							(5)
/*************************************************************************************************/
/*********************						Typedefs						**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************					Function Prototypes					**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************					Static Variables					**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************					Global Variables					**********************/
/*************************************************************************************************/
u08 bRFCommRxCharCounter;
u08 bRFCommTxCharCounter;

u08 baRFCommRxBuffer[RFCommBufferSize];
u08 baRFCommTxBuffer[RFCommBufferSize] = "0123";

u08 *bptrRFCommRxBuffer;
u08 *bptrRFCommTxBuffer;

u08 bRFCommStatus;

LDD_TDeviceData *SPISlaveLDD;
/*************************************************************************************************/
/*********************					Static Constants					**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************					Global Constants					**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************						Functions						**********************/
/*************************************************************************************************/
void vfnRFCommInit(void)
{
	//Init the SPI Slave 
	SPISlaveLDD = SM1_Init(NULL);
	//Turn off flag of Rx
	bRFCommStatus &= ~( 1<<RFCommStatusRxDetected );
	//Request data block reception
	SM1_ReceiveBlock(SPISlaveLDD,&baRFCommRxBuffer[0],20);
	//Start transmission/Reception
	SM1_SendBlock(SPISlaveLDD,&baRFCommTxBuffer[0],4);
	
}
void vfnRFCommTxService(void)
{
	
}
void vfnRFCommManager(void)
{
	if( bRFCommStatus & ( 1<<RFCommStatusRxDetected ) )
	{		
		bRFCommStatus &= ~( 1<<RFCommStatusRxDetected );
		//Request data block reception
		SM1_ReceiveBlock(SPISlaveLDD,&baRFCommRxBuffer[0],20);
		//Start transmission/Reception
		SM1_SendBlock(SPISlaveLDD,&baRFCommTxBuffer[0],4);
	}
}
void vfnRFCommTxMessage(u08 *lbptrBuffer, u08 lbSize)
{
	
}
